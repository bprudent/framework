<template
  xmlns:core="urn:redtree:php-stl:core:v2.0">

<core:param name="message" default="Unhandled Exception" />
<core:param name="exception" required="true" type="Exception" />

<core:set var="exType" value="@{get_class(${exception})}" />
<h1>${=message}</h1>
<h2>${=exType}:</h2>
<h3>${=exception.getMessage()}</h3>
<core:if test="${exception} instanceof PHPSTLNoSuchResource">
  <h3>Template Providers:</h3>
  <ul>
    <core:forEach list="${exception.getPHPSTL().getProviders()}" var="provider">
      <li>${=provider}</li>
    </core:forEach>
  </ul>
</core:if>
<h3>Trace:</h3>
<ul>@{="\n"}
  <core:forEach list="${exception.getTrace()}" var="frame">
    <li><?whitespace trim ?>
      <core:if test="@{array_key_exists('file', ${frame})}">
        <core:out format="sprintf:%s(%s)"
          value="${frame['file']}, ${frame['line']}" />
      <core:else />
        [internal function]
      </core:if>:@{=' '}

      <core:if test="@{array_key_exists('class', ${frame})}">
        ${=frame['class']}
        ${=frame['type']}
      </core:if>
      ${=frame['function']}(
      <core:forEach list="${frame['args']}" var="arg">
        <core:out value="${arg}" format="repr" />
        <core:if test="@{! ${loop.isLast()}}">@{=', '}</core:if>
      </core:forEach>
    )<?whitespace collapse ?></li>@{="\n"}
  </core:forEach>
</ul>

</template>
